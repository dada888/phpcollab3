<?php
/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PluginfdCommentTable extends Doctrine_Table
{
  public function getQueryForComments()
  {
    return Doctrine_Query::create()
            ->from('fdComment fdc');
  }

  public function getQueryForCommentsByModel($model)
  {
    return $this->getQueryForComments()
            ->where('fdc.model = ?', $model);
  }

  public function getQueryForCommentsByModelAndModelField($model, $field)
  {
    return $this->getQueryForCommentsByModel($model)
            ->andWhere('fdc.model_field = ?', $field);
  }

  public function getQueryForListByModelAndFieldAndValue($model, $field, $value)
  {
    return $this->getQueryForCommentsByModelAndModelField($model, $field)
            ->andWhere('fdc.model_field_value = ?', $value)
            ->orderBy('fdc.created_at DESC');
  }

  public function getQueryForCommentsByProfileId($profile_id)
  {
    return $this->getQueryForComments()
            ->andWhere('fdc.profile_id = ?', $profile_id);
  }

  public function getQueryForCommentsByProfileIdAndModel($profile_id, $model_name)
  {
    return $this->getQueryForCommentsByModel($model_name)
            ->andWhere('fdc.profile_id = ?', $profile_id);
  }

  public function getQueryForCommentsByProfileIdAndModelAndModelFieldValue($profile_id, $model_name, $model_name_value)
  {
    return $this->getQueryForCommentsByProfileIdAndModel($profile_id, $model_name)
            ->andWhere('fdc.model_field_value = ?', $model_name_value);
  }

  public function getQueryForProfilesByModelAndModelFieldValue($model_name, $model_name_value)
  {
    $config = sfConfig::get('sf_confing_comments_plugin_Profile', array());
    $q = new Doctrine_RawSql();
    $q->select('{p.*}')
      ->from($config['class_name'].' as p LEFT JOIN fd_comment as fd ON p.'.$config['class_id'].' = fd.profile_id')
      ->addComponent('p', $config['class_name'].' p')
      ->where('fd.model = ?', $model_name)
      ->andWhere('fd.profile_id = p.'.$config['class_id'])
      ->andWhere('fd.model_field_value = ?', $model_name_value)
      ->groupBy('fd.profile_id');

    return $q;
  }

  public function getProfileForComment($profile_id)
  {
    $config = sfConfig::get('sf_confing_comments_plugin_Profile', array());
    
    return Doctrine_Query::create()
            ->from($config['class_name'].' as p')
            ->where('p.'.$config['class_id'].' = ? ', $profile_id)
            ->fetchOne();
  }
}